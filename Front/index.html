<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Пульт управления испытанием</title>
    <style>
        body {
            background: #fff;
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Segoe UI', Arial, sans-serif;
        }
        .panel {
            border: 2px solid #bfc7ce;
            border-radius: 14px;
            padding: 32px 36px 18px 36px;
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.03);
            min-width: 370px;
            max-width: 95vw;
        }
        .panel h2 {
            margin: 0 0 18px 0;
            font-size: 1.3rem;
            font-weight: 700;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1.05rem;
            margin-bottom: 8px;
        }
        .info-label {
            color: #7a7a7a;
        }
        .divider {
            border-bottom: 1px solid #e3e6e8;
            margin: 12px 0 18px 0;
        }
        .controls {
            display: flex;
            gap: 0;
            margin-bottom: 18px;
        }
        .ctrl-btn {
            flex: 1 1 0;
            background: #e3e6e8;
            border: none;
            border-radius: 12px 0 0 12px;
            height: 48px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.15s;
            font-size: 1.3rem;
            outline: none;
        }
        .ctrl-btn + .ctrl-btn {
            border-radius: 0;
            border-left: 1px solid #d0d4d8;
        }
        .ctrl-btn:last-child {
            border-radius: 0 12px 12px 0;
        }
        .ctrl-btn.active {
            background: #cfd8df;
        }
        .ctrl-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }
        .desc {
            color: #b0b0b0;
            font-size: 0.98rem;
            text-align: center;
            margin-top: 8px;
        }
    </style>
</head>
<body>
    <div class="panel">
        <h2>Испытание №<span id="test-number">376</span></h2>
        <div class="info-row">
            <span class="info-label">Объект испытания</span>
            <span id="test-object">ПД-14</span>
        </div>
        <div class="info-row">
            <span class="info-label">Время старта</span>
            <span id="start-time">--:--</span>
        </div>
        <div class="divider"></div>
        <div class="controls">
            <button id="btn-start" class="ctrl-btn" title="Включить">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><polygon points="9,7 22,14 9,21" fill="#6b7680"/></svg>
            </button>
            <button id="btn-pause" class="ctrl-btn" title="Пауза" disabled>
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><rect x="9" y="7" width="3" height="14" rx="1.5" fill="#6b7680"/><rect x="16" y="7" width="3" height="14" rx="1.5" fill="#6b7680"/></svg>
            </button>
            <button id="btn-stop" class="ctrl-btn" title="Выключить">
                <svg width="28" height="28" viewBox="0 0 28 28" fill="none"><rect x="9" y="9" width="10" height="10" rx="2" fill="#6b7680"/></svg>
            </button>
        </div>
        <div class="desc">
            Модуль, который представляет собой пульт управления испытаниями для авиационных двигателей
        </div>
    </div>
    <script>
    // --- WebSocket interaction (заглушка адреса) ---
    const ws = new WebSocket('ws://localhost:8080/ws');

    // Состояние
    let isRunning = false;
    let startTime = null;
    let timerInterval = null;

    // DOM
    const btnStart = document.getElementById('btn-start');
    const btnPause = document.getElementById('btn-pause');
    const btnStop = document.getElementById('btn-stop');
    const startTimeEl = document.getElementById('start-time');

    // Формат времени HH:MM
    function formatTime(date) {
        return date.toLocaleTimeString('ru-RU', { hour: '2-digit', minute: '2-digit' });
    }

    // Обновить отображение времени
    function updateTime() {
        if (isRunning && startTime) {
            startTimeEl.textContent = formatTime(startTime);
        } else {
            startTimeEl.textContent = '--:--';
        }
    }

    // Обновить кнопки
    function updateButtons() {
        btnStart.disabled = isRunning;
        btnStop.disabled = !isRunning;
        btnStart.classList.toggle('active', !isRunning);
        btnStop.classList.toggle('active', isRunning);
    }

    // Запуск испытания
    btnStart.addEventListener('click', () => {
        ws.send(JSON.stringify({ action: 'start' }));
    });

    // Остановка испытания
    btnStop.addEventListener('click', () => {
        ws.send(JSON.stringify({ action: 'stop' }));
    });

    // --- WebSocket events ---
    ws.onopen = () => {
        // При подключении — запросить состояние
        ws.send(JSON.stringify({ action: 'get_state' }));
    };

    ws.onmessage = (event) => {
        // Ожидаем сообщения вида: { running: true/false, startTime: timestamp }
        try {
            const data = JSON.parse(event.data);
            isRunning = !!data.running;
            startTime = data.startTime ? new Date(data.startTime) : null;
            updateTime();
            updateButtons();
        } catch (e) {
            // ignore
        }
    };

    ws.onerror = () => {
        // Ошибка соединения — отключить кнопки
        btnStart.disabled = true;
        btnStop.disabled = true;
        startTimeEl.textContent = 'нет связи';
    };

    ws.onclose = () => {
        btnStart.disabled = true;
        btnStop.disabled = true;
        startTimeEl.textContent = 'нет связи';
    };

    // --- Инициализация ---
    updateTime();
    updateButtons();
    </script>
</body>
</html>